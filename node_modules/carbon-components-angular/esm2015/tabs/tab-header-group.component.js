/**
 *
 * carbon-angular v0.0.0 | tab-header-group.component.js
 *
 * Copyright 2014, 2021 IBM
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0

 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


import { Component, QueryList, Input, HostListener, ContentChildren, ElementRef, TemplateRef } from "@angular/core";
import { TabHeader } from "./tab-header.component";
import { Subscription } from "rxjs";
export class TabHeaderGroup {
    constructor(elementRef) {
        this.elementRef = elementRef;
        /**
         * Set to `true` to put tabs in a loading state.
         */
        this.skeleton = false;
        /**
         * Set to 'true' to have all pane references associated with each tab header
         * in the tab header group cached and not reloaded on tab switching.
         */
        this.cacheActive = false;
        this.isNavigation = false;
        this.type = "default";
        /**
         * Keeps track of all the subscriptions to the tab header selection events.
         */
        this.selectedSubscriptionTracker = new Subscription();
        this.tabListVisible = false;
        /**
         * Controls the manual focusing done by tabbing through headings.
         */
        this.currentSelectedIndex = 0;
        this._cacheActive = false;
    }
    // keyboard accessibility
    /**
     * Controls the keydown events used for tabbing through the headings.
     */
    keyboardInput(event) {
        let tabHeadersArray = Array.from(this.tabHeaderQuery);
        if (event.key === "Right" || event.key === "ArrowRight") {
            if (this.currentSelectedIndex < tabHeadersArray.length - 1) {
                event.preventDefault();
                if (this.followFocus && !tabHeadersArray[this.currentSelectedIndex + 1].disabled) {
                    tabHeadersArray[this.currentSelectedIndex + 1].selectTab();
                }
                else {
                    tabHeadersArray[this.currentSelectedIndex + 1].tabItem.nativeElement.focus();
                    this.currentSelectedIndex++;
                }
            }
            else {
                event.preventDefault();
                if (this.followFocus && !tabHeadersArray[0].disabled) {
                    tabHeadersArray[0].selectTab();
                }
                else {
                    tabHeadersArray[0].tabItem.nativeElement.focus();
                    this.currentSelectedIndex = 0;
                }
            }
        }
        if (event.key === "Left" || event.key === "ArrowLeft") {
            if (this.currentSelectedIndex > 0) {
                event.preventDefault();
                if (this.followFocus && !tabHeadersArray[this.currentSelectedIndex - 1].disabled) {
                    tabHeadersArray[this.currentSelectedIndex - 1].selectTab();
                }
                else {
                    tabHeadersArray[this.currentSelectedIndex - 1].tabItem.nativeElement.focus();
                    this.currentSelectedIndex--;
                }
            }
            else {
                event.preventDefault();
                if (this.followFocus && !tabHeadersArray[tabHeadersArray.length - 1].disabled) {
                    tabHeadersArray[tabHeadersArray.length - 1].selectTab();
                }
                else {
                    tabHeadersArray[tabHeadersArray.length - 1].tabItem.nativeElement.focus();
                    this.currentSelectedIndex = tabHeadersArray.length - 1;
                }
            }
        }
        if (event.key === "Home") {
            event.preventDefault();
            if (this.followFocus && !tabHeadersArray[0].disabled) {
                tabHeadersArray[0].selectTab();
            }
            else {
                tabHeadersArray[0].tabItem.nativeElement.focus();
                this.currentSelectedIndex = 0;
            }
        }
        if (event.key === "End") {
            event.preventDefault();
            if (this.followFocus && !tabHeadersArray[tabHeadersArray.length - 1].disabled) {
                tabHeadersArray[tabHeadersArray.length - 1].selectTab();
            }
            else {
                tabHeadersArray[tabHeadersArray.length - 1].tabItem.nativeElement.focus();
                this.currentSelectedIndex = tabHeadersArray.length - 1;
            }
        }
        // `"Spacebar"` is IE11 specific value
        if ((event.key === " " || event.key === "Spacebar") && !this.followFocus) {
            tabHeadersArray[this.currentSelectedIndex].selectTab();
        }
        // dropdown list handler
        if (event.key === "Escape") {
            this.tabListVisible = false;
        }
    }
    focusOut(event) {
        if (this.tabListVisible && !this.elementRef.nativeElement.contains(event.relatedTarget)) {
            this.tabListVisible = false;
        }
    }
    ngAfterContentInit() {
        this.selectedSubscriptionTracker.unsubscribe();
        if (this.tabHeaderQuery) {
            this.tabHeaderQuery.toArray()
                .forEach(tabHeader => {
                tabHeader.cacheActive = this.cacheActive;
                tabHeader.paneTabIndex = this.isNavigation ? null : 0;
            });
        }
        const selectedSubscriptions = this.tabHeaderQuery.toArray().forEach(tabHeader => {
            tabHeader.selected.subscribe(() => {
                this.currentSelectedIndex = this.tabHeaderQuery.toArray().indexOf(tabHeader);
                // The Filter takes the current selected tab out, then all other headers are
                // deactivated and their associated pane references are also deactivated.
                this.tabHeaderQuery.toArray().filter(header => header !== tabHeader)
                    .forEach(filteredHeader => {
                    filteredHeader.active = false;
                    if (filteredHeader.paneReference) {
                        filteredHeader.paneReference.active = false;
                    }
                });
            });
        });
        this.selectedSubscriptionTracker.add(selectedSubscriptions);
        setTimeout(() => this.tabHeaderQuery.toArray()[this.currentSelectedIndex].selectTab());
    }
    ngOnChanges(changes) {
        if (this.tabHeaderQuery) {
            if (changes.cacheActive) {
                this.tabHeaderQuery.toArray().forEach(tabHeader => tabHeader.cacheActive = this.cacheActive);
            }
            if (changes.isNavigation) {
                this.tabHeaderQuery.toArray()
                    .forEach(tabHeader => tabHeader.paneTabIndex = this.isNavigation ? null : 0);
            }
        }
    }
    getSelectedTab() {
        const selected = this.tabHeaderQuery.toArray()[this.currentSelectedIndex];
        if (selected) {
            return selected;
        }
        return {
            headingIsTemplate: false,
            heading: ""
        };
    }
    showTabList() {
        this.tabListVisible = true;
        const focusTarget = this.tabHeaderQuery.toArray().find(tab => {
            const tabContainer = tab.tabItem.nativeElement.parentElement;
            return !tabContainer.classList.contains("bx--tabs__nav-item--selected");
        });
        focusTarget.tabItem.nativeElement.focus();
    }
    onDropdownKeydown(event) {
        switch (event.key) {
            case " ":
            case "Spacebar":
            case "Enter":
                event.preventDefault();
                this.showTabList();
                break;
            default:
                break;
        }
    }
    tabDropdownKeydown(event) {
        if (!this.tabListVisible) {
            return;
        }
        const target = event.target.closest("a");
        const headers = this.tabHeaderQuery.toArray().filter(tab => !tab.tabItem.nativeElement.parentElement.classList.contains("bx--tabs__nav-item--disabled") &&
            !tab.tabItem.nativeElement.parentElement.classList.contains("bx--tabs__nav-item--selected"));
        // unless focus can move, it should remain on the target
        let next = target;
        let previous = target;
        for (let i = 0; i < headers.length; i++) {
            if (headers[i].tabItem.nativeElement === target) {
                if (i + 1 < headers.length) {
                    next = headers[i + 1].tabItem.nativeElement;
                }
                if (i - 1 >= 0) {
                    previous = headers[i - 1].tabItem.nativeElement;
                }
            }
        }
        switch (event.key) {
            case "ArrowDown":
            case "Down": // IE11 specific value
                next.focus();
                break;
            case "ArrowUp":
            case "Up": // IE11 specific value
                previous.focus();
                break;
            default:
                break;
        }
    }
    ngOnDestroy() {
        this.selectedSubscriptionTracker.unsubscribe();
    }
}
TabHeaderGroup.decorators = [
    { type: Component, args: [{
                selector: "ibm-tab-header-group",
                template: `
	<nav
		class="bx--tabs"
		[ngClass]="{
			'bx--skeleton': skeleton,
			'bx--tabs--container': type === 'container'
		}"
		role="navigation"
		[attr.aria-label]="ariaLabel"
		[attr.aria-labelledby]="ariaLabelledby">
		<div
			class="bx--tabs-trigger"
			tabindex="0"
			(click)="showTabList()"
			(keydown)="onDropdownKeydown($event)">
			<a
				href="javascript:void(0)"
				class="bx--tabs-trigger-text"
				tabindex="-1"
				*ngIf="(!getSelectedTab().headingIsTemplate && getSelectedTab().heading != '') || getSelectedTab().headingIsTemplate">
				<ng-container *ngIf="!getSelectedTab().headingIsTemplate">
					{{ getSelectedTab().heading }}
				</ng-container>
				<ng-template
					*ngIf="getSelectedTab().headingIsTemplate"
					[ngTemplateOutlet]="getSelectedTab().heading"
					[ngTemplateOutletContext]="{$implicit: getSelectedTab().context}">
				</ng-template>
			</a>
			<svg width="10" height="5" viewBox="0 0 10 5">
				<path d="M0 0l5 4.998L10 0z" fill-rule="evenodd"></path>
			</svg>
		</div>
		<ul
			#tabList
			[ngClass]="{
				'bx--tabs__nav--hidden': !tabListVisible
			}"
			(keydown)="tabDropdownKeydown($event)"
			class="bx--tabs__nav"
			role="tablist">
			<li role="presentation">
				<ng-container *ngIf="contentBefore" [ngTemplateOutlet]="contentBefore"></ng-container>
			</li>
			<ng-content></ng-content>
			<li role="presentation">
				<ng-container *ngIf="contentAfter" [ngTemplateOutlet]="contentAfter"></ng-container>
			</li>
		</ul>
	</nav>
	`
            }] }
];
/** @nocollapse */
TabHeaderGroup.ctorParameters = () => [
    { type: ElementRef }
];
TabHeaderGroup.propDecorators = {
    followFocus: [{ type: Input }],
    skeleton: [{ type: Input }],
    ariaLabel: [{ type: Input }],
    ariaLabelledby: [{ type: Input }],
    contentAfter: [{ type: Input }],
    contentBefore: [{ type: Input }],
    cacheActive: [{ type: Input }],
    isNavigation: [{ type: Input }],
    type: [{ type: Input }],
    tabHeaderQuery: [{ type: ContentChildren, args: [TabHeader,] }],
    keyboardInput: [{ type: HostListener, args: ["keydown", ["$event"],] }],
    focusOut: [{ type: HostListener, args: ["focusout", ["$event"],] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFiLWhlYWRlci1ncm91cC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9jYXJib24tY29tcG9uZW50cy1hbmd1bGFyL3RhYnMvIiwic291cmNlcyI6WyJ0YWItaGVhZGVyLWdyb3VwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ04sU0FBUyxFQUNULFNBQVMsRUFDVCxLQUFLLEVBQ0wsWUFBWSxFQUNaLGVBQWUsRUFHZixVQUFVLEVBQ1YsV0FBVyxFQUdYLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNuRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBd0RwQyxNQUFNLE9BQU8sY0FBYztJQWdEMUIsWUFBc0IsVUFBc0I7UUFBdEIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQTNDNUM7O1dBRUc7UUFDTSxhQUFRLEdBQUcsS0FBSyxDQUFDO1FBYzFCOzs7V0FHRztRQUNNLGdCQUFXLEdBQUcsS0FBSyxDQUFDO1FBRXBCLGlCQUFZLEdBQUcsS0FBSyxDQUFDO1FBQ3JCLFNBQUksR0FBNEIsU0FBUyxDQUFDO1FBTW5EOztXQUVHO1FBQ0gsZ0NBQTJCLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUUxQyxtQkFBYyxHQUFHLEtBQUssQ0FBQztRQUM5Qjs7V0FFRztRQUNJLHlCQUFvQixHQUFHLENBQUMsQ0FBQztRQUV4QixpQkFBWSxHQUFHLEtBQUssQ0FBQztJQUVrQixDQUFDO0lBRWhELHlCQUF5QjtJQUN6Qjs7T0FFRztJQUVILGFBQWEsQ0FBQyxLQUFLO1FBQ2xCLElBQUksZUFBZSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQU0sSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRTNELElBQUksS0FBSyxDQUFDLEdBQUcsS0FBSyxPQUFPLElBQUksS0FBSyxDQUFDLEdBQUcsS0FBSyxZQUFZLEVBQUU7WUFDeEQsSUFBSSxJ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TUwsS0FBSzsyQkFFTCxLQUFLO21CQUNMLEtBQUs7NkJBS0wsZUFBZSxTQUFDLFNBQVM7NEJBb0J6QixZQUFZLFNBQUMsU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDO3VCQTJFbEMsWUFBWSxTQUFDLFVBQVUsRUFBRSxDQUFDLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG5cdENvbXBvbmVudCxcblx0UXVlcnlMaXN0LFxuXHRJbnB1dCxcblx0SG9zdExpc3RlbmVyLFxuXHRDb250ZW50Q2hpbGRyZW4sXG5cdE9uRGVzdHJveSxcblx0QWZ0ZXJDb250ZW50SW5pdCxcblx0RWxlbWVudFJlZixcblx0VGVtcGxhdGVSZWYsXG5cdE9uQ2hhbmdlcyxcblx0U2ltcGxlQ2hhbmdlc1xufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuXG5pbXBvcnQgeyBUYWJIZWFkZXIgfSBmcm9tIFwiLi90YWItaGVhZGVyLmNvbXBvbmVudFwiO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSBcInJ4anNcIjtcblxuQENvbXBvbmVudCh7XG5cdHNlbGVjdG9yOiBcImlibS10YWItaGVhZGVyLWdyb3VwXCIsXG5cdHRlbXBsYXRlOiBgXG5cdDxuYXZcblx0XHRjbGFzcz1cImJ4LS10YWJzXCJcblx0XHRbbmdDbGFzc109XCJ7XG5cdFx0XHQnYngtLXNrZWxldG9uJzogc2tlbGV0b24sXG5cdFx0XHQnYngtLXRhYnMtLWNvbnRhaW5lcic6IHR5cGUgPT09ICdjb250YWluZXInXG5cdFx0fVwiXG5cdFx0cm9sZT1cIm5hdmlnYXRpb25cIlxuXHRcdFthdHRyLmFyaWEtbGFiZWxdPVwiYXJpYUxhYmVsXCJcblx0XHRbYXR0ci5hcmlhLWxhYmVsbGVkYnldPVwiYXJpYUxhYmVsbGVkYnlcIj5cblx0XHQ8ZGl2XG5cdFx0XHRjbGFzcz1cImJ4LS10YWJzLXRyaWdnZXJcIlxuXHRcdFx0dGFiaW5kZXg9XCIwXCJcblx0XHRcdChjbGljayk9XCJzaG93VGFiTGlzdCgpXCJcblx0XHRcdChrZXlkb3duKT1cIm9uRHJvcGRvd25LZXlkb3duKCRldmVudClcIj5cblx0XHRcdDxhXG5cdFx0XHRcdGhyZWY9XCJqYXZhc2NyaXB0OnZvaWQoMClcIlxuXHRcdFx0XHRjbGFzcz1cImJ4LS10YWJzLXRyaWdnZXItdGV4dFwiXG5cdFx0XHRcdHRhYmluZGV4PVwiLTFcIlxuXHRcdFx0XHQqbmdJZj1cIighZ2V0U2VsZWN0ZWRUYWIoKS5oZWFkaW5nSXNUZW1wbGF0ZSAmJiBnZXRTZWxlY3RlZFRhYigpLmhlYWRpbmcgIT0gJycpIHx8IGdldFNlbGVjdGVkVGFiKCkuaGVhZGluZ0lzVGVtcGxhdGVcIj5cblx0XHRcdFx0PG5nLWNvbnRhaW5lciAqbmdJZj1cIiFnZXRTZWxlY3RlZFRhYigpLmhlYWRpbmdJc1RlbXBsYXRlXCI+XG5cdFx0XHRcdFx0e3sgZ2V0U2VsZWN0ZWRUYWIoKS5oZWFkaW5nIH19XG5cdFx0XHRcdDwvbmctY29udGFpbmVyPlxuXHRcdFx0XHQ8bmctdGVtcGxhdGVcblx0XHRcdFx0XHQqbmdJZj1cImdldFNlbGVjdGVkVGFiKCkuaGVhZGluZ0lzVGVtcGxhdGVcIlxuXHRcdFx0XHRcdFtuZ1RlbXBsYXRlT3V0bGV0XT1cImdldFNlbGVjdGVkVGFiKCkuaGVhZGluZ1wiXG5cdFx0XHRcdFx0W25nVGVtcGxhdGVPdXRsZXRDb250ZXh0XT1cInskaW1wbGljaXQ6IGdldFNlbGVjdGVkVGFiKCkuY29udGV4dH1cIj5cblx0XHRcdFx0PC9uZy10ZW1wbGF0ZT5cblx0XHRcdDwvYT5cblx0XHRcdDxzdmcgd2lkdGg9XCIxMFwiIGhlaWdodD1cIjVcIiB2aWV3Qm94PVwiMCAwIDEwIDVcIj5cblx0XHRcdFx0PHBhdGggZD1cIk0wIDBsNSA0Ljk5OEwxMCAwelwiIGZpbGwtcnVsZT1cImV2ZW5vZGRcIj48L3BhdGg+XG5cdFx0XHQ8L3N2Zz5cblx0XHQ8L2Rpdj5cblx0XHQ8dWxcblx0XHRcdCN0YWJMaXN0XG5cdFx0XHRbbmdDbGFzc109XCJ7XG5cdFx0XHRcdCdieC0tdGFic19fbmF2LS1oaWRkZW4nOiAhdGFiTGlzdFZpc2libGVcblx0XHRcdH1cIlxuXHRcdFx0KGtleWRvd24pPVwidGFiRHJvcGRvd25LZXlkb3duKCRldmVudClcIlxuXHRcdFx0Y2xhc3M9XCJieC0tdGFic19fbmF2XCJcblx0XHRcdHJvbGU9XCJ0YWJsaXN0XCI+XG5cdFx0XHQ8bGkgcm9sZT1cInByZXNlbnRhdGlvblwiPlxuXHRcdFx0XHQ8bmctY29udGFpbmVyICpuZ0lmPVwiY29udGVudEJlZm9yZVwiIFtuZ1RlbXBsYXRlT3V0bGV0XT1cImNvbnRlbnRCZWZvcmVcIj48L25nLWNvbnRhaW5lcj5cblx0XHRcdDwvbGk+XG5cdFx0XHQ8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG5cdFx0XHQ8bGkgcm9sZT1cInByZXNlbnRhdGlvblwiPlxuXHRcdFx0XHQ8bmctY29udGFpbmVyICpuZ0lmPVwiY29udGVudEFmdGVyXCIgW25nVGVtcGxhdGVPdXRsZXRdPVwiY29udGVudEFmdGVyXCI+PC9uZy1jb250YWluZXI+XG5cdFx0XHQ8L2xpPlxuXHRcdDwvdWw+XG5cdDwvbmF2PlxuXHRgXG59KVxuZXhwb3J0IGNsYXNzIFRhYkhlYWRlckdyb3VwIGltcGxlbWVudHMgQWZ0ZXJDb250ZW50SW5pdCwgT25EZXN0cm95LCBPbkNoYW5nZXMge1xuXHQvKipcblx0ICogU2V0IHRvICd0cnVlJyB0byBoYXZlIHRhYnMgYXV0b21hdGljYWxseSBhY3RpdmF0ZWQgYW5kIGhhdmUgdGhlaXIgY29udGVudCBkaXNwbGF5ZWQgd2hlbiB0aGV5IHJlY2VpdmUgZm9jdXMuXG5cdCAqL1xuXHRASW5wdXQoKSBmb2xsb3dGb2N1czogYm9vbGVhbjtcblx0LyoqXG5cdCAqIFNldCB0byBgdHJ1ZWAgdG8gcHV0IHRhYnMgaW4gYSBsb2FkaW5nIHN0YXRlLlxuXHQgKi9cblx0QElucHV0KCkgc2tlbGV0b24gPSBmYWxzZTtcblx0LyoqXG5cdCAqIFNldHMgdGhlIGFyaWEgbGFiZWwgb24gdGhlIG5hdiBlbGVtZW50LlxuXHQgKi9cblx0QElucHV0KCkgYXJpYUxhYmVsOiBzdHJpbmc7XG5cdC8qKlxuXHQgKiBTZXRzIHRoZSBhcmlhIGxhYmVsbGVkYnkgb24gdGhlIG5hdiBlbGVtZW50LlxuXHQgKi9cblx0QElucHV0KCkgYXJpYUxhYmVsbGVkYnk6IHN0cmluZztcblxuXHRASW5wdXQoKSBjb250ZW50QWZ0ZXI6IFRlbXBsYXRlUmVmPGFueT47XG5cblx0QElucHV0KCkgY29udGVudEJlZm9yZTogVGVtcGxhdGVSZWY8YW55PjtcblxuXHQvKipcblx0ICogU2V0IHRvICd0cnVlJyB0byBoYXZlIGFsbCBwYW5lIHJlZmVyZW5jZXMgYXNzb2NpYXRlZCB3aXRoIGVhY2ggdGFiIGhlYWRlclxuXHQgKiBpbiB0aGUgdGFiIGhlYWRlciBncm91cCBjYWNoZWQgYW5kIG5vdCByZWxvYWRlZCBvbiB0YWIgc3dpdGNoaW5nLlxuXHQgKi9cblx0QElucHV0KCkgY2FjaGVBY3RpdmUgPSBmYWxzZTtcblxuXHRASW5wdXQoKSBpc05hdmlnYXRpb24gPSBmYWxzZTtcblx0QElucHV0KCkgdHlwZTogXCJkZWZhdWx0XCIgfCBcImNvbnRhaW5lclwiID0gXCJkZWZhdWx0XCI7XG5cblx0LyoqXG5cdCAqIENvbnRlbnRDaGlsZHJlbiBvZiBhbGwgdGhlIHRhYkhlYWRlcnMuXG5cdCAqL1xuXHRAQ29udGVudENoaWxkcmVuKFRhYkhlYWRlcikgdGFiSGVhZGVyUXVlcnk6IFF1ZXJ5TGlzdDxUYWJIZWFkZXI+O1xuXHQvKipcblx0ICogS2VlcHMgdHJhY2sgb2YgYWxsIHRoZSBzdWJzY3JpcHRpb25zIHRvIHRoZSB0YWIgaGVhZGVyIHNlbGVjdGlvbiBldmVudHMuXG5cdCAqL1xuXHRzZWxlY3RlZFN1YnNjcmlwdGlvblRyYWNrZXIgPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG5cblx0cHVibGljIHRhYkxpc3RWaXNpYmxlID0gZmFsc2U7XG5cdC8qKlxuXHQgKiBDb250cm9scyB0aGUgbWFudWFsIGZvY3VzaW5nIGRvbmUgYnkgdGFiYmluZyB0aHJvdWdoIGhlYWRpbmdzLlxuXHQgKi9cblx0cHVibGljIGN1cnJlbnRTZWxlY3RlZEluZGV4ID0gMDtcblxuXHRwcml2YXRlIF9jYWNoZUFjdGl2ZSA9IGZhbHNlO1xuXG5cdGNvbnN0cnVjdG9yKHByb3RlY3RlZCBlbGVtZW50UmVmOiBFbGVtZW50UmVmKSB7fVxuXG5cdC8vIGtleWJvYXJkIGFjY2Vzc2liaWxpdHlcblx0LyoqXG5cdCAqIENvbnRyb2xzIHRoZSBrZXlkb3duIGV2ZW50cyB1c2VkIGZvciB0YWJiaW5nIHRocm91Z2ggdGhlIGhlYWRpbmdzLlxuXHQgKi9cblx0QEhvc3RMaXN0ZW5lcihcImtleWRvd25cIiwgW1wiJGV2ZW50XCJdKVxuXHRrZXlib2FyZElucHV0KGV2ZW50KSB7XG5cdFx0bGV0IHRhYkhlYWRlcnNBcnJheSA9IEFycmF5LmZyb208YW55Pih0aGlzLnRhYkhlYWRlclF1ZXJ5KTtcblxuXHRcdGlmIChldmVudC5rZXkgPT09IFwiUmlnaHRcIiB8fCBldmVudC5rZXkgPT09IFwiQXJyb3dSaWdodFwiKSB7XG5cdFx0XHRpZiAodGhpcy5jdXJyZW50U2VsZWN0ZWRJbmRleCA8IHRhYkhlYWRlcnNBcnJheS5sZW5ndGggLSAxKSB7XG5cdFx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdGlmICh0aGlzLmZvbGxvd0ZvY3VzICYmICF0YWJIZWFkZXJzQXJyYXlbdGhpcy5jdXJyZW50U2VsZWN0ZWRJbmRleCArIDFdLmRpc2FibGVkKSB7XG5cdFx0XHRcdFx0dGFiSGVhZGVyc0FycmF5W3RoaXMuY3VycmVudFNlbGVjdGVkSW5kZXggKyAxXS5zZWxlY3RUYWIoKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0YWJIZWFkZXJzQXJyYXlbdGhpcy5jdXJyZW50U2VsZWN0ZWRJbmRleCArIDFdLnRhYkl0ZW0ubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuXHRcdFx0XHRcdHRoaXMuY3VycmVudFNlbGVjdGVkSW5kZXgrKztcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0aWYgKHRoaXMuZm9sbG93Rm9jdXMgJiYgIXRhYkhlYWRlcnNBcnJheVswXS5kaXNhYmxlZCkge1xuXHRcdFx0XHRcdHRhYkhlYWRlcnNBcnJheVswXS5zZWxlY3RUYWIoKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0YWJIZWFkZXJzQXJyYXlbMF0udGFiSXRlbS5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG5cdFx0XHRcdFx0dGhpcy5jdXJyZW50U2VsZWN0ZWRJbmRleCA9IDA7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoZXZlbnQua2V5ID09PSBcIkxlZnRcIiB8fCBldmVudC5rZXkgPT09IFwiQXJyb3dMZWZ0XCIpIHtcblx0XHRcdGlmICh0aGlzLmN1cnJlbnRTZWxlY3RlZEluZGV4ID4gMCkge1xuXHRcdFx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRpZiAodGhpcy5mb2xsb3dGb2N1cyAmJiAhdGFiSGVhZGVyc0FycmF5W3RoaXMuY3VycmVudFNlbGVjdGVkSW5kZXggLSAxXS5kaXNhYmxlZCkge1xuXHRcdFx0XHRcdHRhYkhlYWRlcnNBcnJheVt0aGlzLmN1cnJlbnRTZWxlY3RlZEluZGV4IC0gMV0uc2VsZWN0VGFiKCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGFiSGVhZGVyc0FycmF5W3RoaXMuY3VycmVudFNlbGVjdGVkSW5kZXggLSAxXS50YWJJdGVtLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcblx0XHRcdFx0XHR0aGlzLmN1cnJlbnRTZWxlY3RlZEluZGV4LS07XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdGlmICh0aGlzLmZvbGxvd0ZvY3VzICYmICF0YWJIZWFkZXJzQXJyYXlbdGFiSGVhZGVyc0FycmF5Lmxlbmd0aCAtIDFdLmRpc2FibGVkKSB7XG5cdFx0XHRcdFx0dGFiSGVhZGVyc0FycmF5W3RhYkhlYWRlcnNBcnJheS5sZW5ndGggLSAxXS5zZWxlY3RUYWIoKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0YWJIZWFkZXJzQXJyYXlbdGFiSGVhZGVyc0FycmF5Lmxlbmd0aCAtIDFdLnRhYkl0ZW0ubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuXHRcdFx0XHRcdHRoaXMuY3VycmVudFNlbGVjdGVkSW5kZXggPSB0YWJIZWFkZXJzQXJyYXkubGVuZ3RoIC0gMTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChldmVudC5rZXkgPT09IFwiSG9tZVwiKSB7XG5cdFx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0aWYgKHRoaXMuZm9sbG93Rm9jdXMgJiYgIXRhYkhlYWRlcnNBcnJheVswXS5kaXNhYmxlZCkge1xuXHRcdFx0XHR0YWJIZWFkZXJzQXJyYXlbMF0uc2VsZWN0VGFiKCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0YWJIZWFkZXJzQXJyYXlbMF0udGFiSXRlbS5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG5cdFx0XHRcdHRoaXMuY3VycmVudFNlbGVjdGVkSW5kZXggPSAwO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChldmVudC5rZXkgPT09IFwiRW5kXCIpIHtcblx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRpZiAodGhpcy5mb2xsb3dGb2N1cyAmJiAhdGFiSGVhZGVyc0FycmF5W3RhYkhlYWRlcnNBcnJheS5sZW5ndGggLSAxXS5kaXNhYmxlZCkge1xuXHRcdFx0XHR0YWJIZWFkZXJzQXJyYXlbdGFiSGVhZGVyc0FycmF5Lmxlbmd0aCAtIDFdLnNlbGVjdFRhYigpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGFiSGVhZGVyc0FycmF5W3RhYkhlYWRlcnNBcnJheS5sZW5ndGggLSAxXS50YWJJdGVtLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcblx0XHRcdFx0dGhpcy5jdXJyZW50U2VsZWN0ZWRJbmRleCA9IHRhYkhlYWRlcnNBcnJheS5sZW5ndGggLSAxO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIGBcIlNwYWNlYmFyXCJgIGlzIElFMTEgc3BlY2lmaWMgdmFsdWVcblx0XHRpZiAoKGV2ZW50LmtleSA9PT0gXCIgXCIgfHwgZXZlbnQua2V5ID09PSBcIlNwYWNlYmFyXCIpICYmICF0aGlzLmZvbGxvd0ZvY3VzKSB7XG5cdFx0XHR0YWJIZWFkZXJzQXJyYXlbdGhpcy5jdXJyZW50U2VsZWN0ZWRJbmRleF0uc2VsZWN0VGFiKCk7XG5cdFx0fVxuXG5cdFx0Ly8gZHJvcGRvd24gbGlzdCBoYW5kbGVyXG5cdFx0aWYgKGV2ZW50LmtleSA9PT0gXCJFc2NhcGVcIikge1xuXHRcdFx0dGhpcy50YWJMaXN0VmlzaWJsZSA9IGZhbHNlO1xuXHRcdH1cblx0fVxuXG5cdEBIb3N0TGlzdGVuZXIoXCJmb2N1c291dFwiLCBbXCIkZXZlbnRcIl0pXG5cdGZvY3VzT3V0KGV2ZW50KSB7XG5cdFx0aWYgKHRoaXMudGFiTGlzdFZpc2libGUgJiYgIXRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNvbnRhaW5zKGV2ZW50LnJlbGF0ZWRUYXJnZXQpKSB7XG5cdFx0XHR0aGlzLnRhYkxpc3RWaXNpYmxlID0gZmFsc2U7XG5cdFx0fVxuXHR9XG5cblx0bmdBZnRlckNvbnRlbnRJbml0KCkge1xuXHRcdHRoaXMuc2VsZWN0ZWRTdWJzY3JpcHRpb25UcmFja2VyLnVuc3Vic2NyaWJlKCk7XG5cblx0XHRpZiAodGhpcy50YWJIZWFkZXJRdWVyeSkge1xuXHRcdFx0dGhpcy50YWJIZWFkZXJRdWVyeS50b0FycmF5KClcblx0XHRcdFx0LmZvckVhY2godGFiSGVhZGVyID0+IHtcblx0XHRcdFx0XHR0YWJIZWFkZXIuY2FjaGVBY3RpdmUgPSB0aGlzLmNhY2hlQWN0aXZlO1xuXHRcdFx0XHRcdHRhYkhlYWRlci5wYW5lVGFiSW5kZXggPSB0aGlzLmlzTmF2aWdhdGlvbiA/IG51bGwgOiAwO1xuXHRcdFx0XHR9KTtcblx0XHR9XG5cblx0XHRjb25zdCBzZWxlY3RlZFN1YnNjcmlwdGlvbnMgPSB0aGlzLnRhYkhlYWRlclF1ZXJ5LnRvQXJyYXkoKS5mb3JFYWNoKHRhYkhlYWRlciA9PiB7XG5cdFx0XHR0YWJIZWFkZXIuc2VsZWN0ZWQuc3Vic2NyaWJlKCgpID0+IHtcblx0XHRcdFx0dGhpcy5jdXJyZW50U2VsZWN0ZWRJbmRleCA9IHRoaXMudGFiSGVhZGVyUXVlcnkudG9BcnJheSgpLmluZGV4T2YodGFiSGVhZGVyKTtcblx0XHRcdFx0Ly8gVGhlIEZpbHRlciB0YWtlcyB0aGUgY3VycmVudCBzZWxlY3RlZCB0YWIgb3V0LCB0aGVuIGFsbCBvdGhlciBoZWFkZXJzIGFyZVxuXHRcdFx0XHQvLyBkZWFjdGl2YXRlZCBhbmQgdGhlaXIgYXNzb2NpYXRlZCBwYW5lIHJlZmVyZW5jZXMgYXJlIGFsc28gZGVhY3RpdmF0ZWQuXG5cdFx0XHRcdHRoaXMudGFiSGVhZGVyUXVlcnkudG9BcnJheSgpLmZpbHRlcihoZWFkZXIgPT4gaGVhZGVyICE9PSB0YWJIZWFkZXIpXG5cdFx0XHRcdFx0LmZvckVhY2goZmlsdGVyZWRIZWFkZXIgPT4ge1xuXHRcdFx0XHRcdFx0ZmlsdGVyZWRIZWFkZXIuYWN0aXZlID0gZmFsc2U7XG5cdFx0XHRcdFx0XHRpZiAoZmlsdGVyZWRIZWFkZXIucGFuZVJlZmVyZW5jZSkge1xuXHRcdFx0XHRcdFx0XHRmaWx0ZXJlZEhlYWRlci5wYW5lUmVmZXJlbmNlLmFjdGl2ZSA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fSk7XG5cdFx0dGhpcy5zZWxlY3RlZFN1YnNjcmlwdGlvblRyYWNrZXIuYWRkKHNlbGVjdGVkU3Vic2NyaXB0aW9ucyk7XG5cblx0XHRzZXRUaW1lb3V0KCgpID0+IHRoaXMudGFiSGVhZGVyUXVlcnkudG9BcnJheSgpW3RoaXMuY3VycmVudFNlbGVjdGVkSW5kZXhdLnNlbGVjdFRhYigpKTtcblx0fVxuXG5cdG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcblx0XHRpZiAodGhpcy50YWJIZWFkZXJRdWVyeSkge1xuXHRcdFx0aWYgKGNoYW5nZXMuY2FjaGVBY3RpdmUpIHtcblx0XHRcdFx0dGhpcy50YWJIZWFkZXJRdWVyeS50b0FycmF5KCkuZm9yRWFjaCh0YWJIZWFkZXIgPT4gdGFiSGVhZGVyLmNhY2hlQWN0aXZlID0gdGhpcy5jYWNoZUFjdGl2ZSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChjaGFuZ2VzLmlzTmF2aWdhdGlvbikge1xuXHRcdFx0XHR0aGlzLnRhYkhlYWRlclF1ZXJ5LnRvQXJyYXkoKVxuXHRcdFx0XHRcdC5mb3JFYWNoKHRhYkhlYWRlciA9PiB0YWJIZWFkZXIucGFuZVRhYkluZGV4ID0gdGhpcy5pc05hdmlnYXRpb24gPyBudWxsIDogMCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGdldFNlbGVjdGVkVGFiKCk6IGFueSB7XG5cdFx0Y29uc3Qgc2VsZWN0ZWQgPSAgdGhpcy50YWJIZWFkZXJRdWVyeS50b0FycmF5KClbdGhpcy5jdXJyZW50U2VsZWN0ZWRJbmRleF07XG5cdFx0aWYgKHNlbGVjdGVkKSB7XG5cdFx0XHRyZXR1cm4gc2VsZWN0ZWQ7XG5cdFx0fVxuXHRcdHJldHVybiB7XG5cdFx0XHRoZWFkaW5nSXNUZW1wbGF0ZTogZmFsc2UsXG5cdFx0XHRoZWFkaW5nOiBcIlwiXG5cdFx0fTtcblx0fVxuXG5cdHB1YmxpYyBzaG93VGFiTGlzdCgpIHtcblx0XHR0aGlzLnRhYkxpc3RWaXNpYmxlID0gdHJ1ZTtcblx0XHRjb25zdCBmb2N1c1RhcmdldCA9IHRoaXMudGFiSGVhZGVyUXVlcnkudG9BcnJheSgpLmZpbmQodGFiID0+IHtcblx0XHRcdGNvbnN0IHRhYkNvbnRhaW5lciA9IHRhYi50YWJJdGVtLm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudDtcblx0XHRcdHJldHVybiAhdGFiQ29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucyhcImJ4LS10YWJzX19uYXYtaXRlbS0tc2VsZWN0ZWRcIik7XG5cdFx0fSk7XG5cdFx0Zm9jdXNUYXJnZXQudGFiSXRlbS5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG5cdH1cblxuXHRwdWJsaWMgb25Ecm9wZG93bktleWRvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcblx0XHRzd2l0Y2ggKGV2ZW50LmtleSkge1xuXHRcdFx0Y2FzZSBcIiBcIjpcblx0XHRcdGNhc2UgXCJTcGFjZWJhclwiOlxuXHRcdFx0Y2FzZSBcIkVudGVyXCI6XG5cdFx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdHRoaXMuc2hvd1RhYkxpc3QoKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgdGFiRHJvcGRvd25LZXlkb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG5cdFx0aWYgKCF0aGlzLnRhYkxpc3RWaXNpYmxlKSB7IHJldHVybjsgfVxuXG5cdFx0Y29uc3QgdGFyZ2V0ID0gKGV2ZW50LnRhcmdldCBhcyBIVE1MRWxlbWVudCkuY2xvc2VzdChcImFcIik7XG5cblx0XHRjb25zdCBoZWFkZXJzID0gdGhpcy50YWJIZWFkZXJRdWVyeS50b0FycmF5KCkuZmlsdGVyKHRhYiA9PlxuXHRcdFx0IXRhYi50YWJJdGVtLm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJieC0tdGFic19fbmF2LWl0ZW0tLWRpc2FibGVkXCIpICYmXG5cdFx0XHQhdGFiLnRhYkl0ZW0ubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhcImJ4LS10YWJzX19uYXYtaXRlbS0tc2VsZWN0ZWRcIikpO1xuXG5cdFx0Ly8gdW5sZXNzIGZvY3VzIGNhbiBtb3ZlLCBpdCBzaG91bGQgcmVtYWluIG9uIHRoZSB0YXJnZXRcblx0XHRsZXQgbmV4dDogSFRNTEVsZW1lbnQgPSB0YXJnZXQ7XG5cdFx0bGV0IHByZXZpb3VzOiBIVE1MRWxlbWVudCA9IHRhcmdldDtcblxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgaGVhZGVycy5sZW5ndGg7IGkrKykge1xuXHRcdFx0aWYgKGhlYWRlcnNbaV0udGFiSXRlbS5uYXRpdmVFbGVtZW50ID09PSB0YXJnZXQpIHtcblx0XHRcdFx0aWYgKGkgKyAxIDwgaGVhZGVycy5sZW5ndGgpIHtcblx0XHRcdFx0XHRuZXh0ID0gaGVhZGVyc1tpICsgMV0udGFiSXRlbS5uYXRpdmVFbGVtZW50O1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmIChpIC0gMSA+PSAwKSB7XG5cdFx0XHRcdFx0cHJldmlvdXMgPSBoZWFkZXJzW2kgLSAxXS50YWJJdGVtLm5hdGl2ZUVsZW1lbnQ7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRzd2l0Y2ggKGV2ZW50LmtleSkge1xuXHRcdFx0Y2FzZSBcIkFycm93RG93blwiOlxuXHRcdFx0Y2FzZSBcIkRvd25cIjogLy8gSUUxMSBzcGVjaWZpYyB2YWx1ZVxuXHRcdFx0XHRuZXh0LmZvY3VzKCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSBcIkFycm93VXBcIjpcblx0XHRcdGNhc2UgXCJVcFwiOiAvLyBJRTExIHNwZWNpZmljIHZhbHVlXG5cdFx0XHRcdHByZXZpb3VzLmZvY3VzKCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9XG5cblx0bmdPbkRlc3Ryb3koKSB7XG5cdFx0dGhpcy5zZWxlY3RlZFN1YnNjcmlwdGlvblRyYWNrZXIudW5zdWJzY3JpYmUoKTtcblx0fVxufVxuIl19